<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="description" content="Simple text to speech" />
    <meta name="theme-color" content="#000" />

    <title>Parayu</title>

    <link tag="link" rel="manifest" href="manifest.json" />
    <link rel="canonical" href="Parayu" />

    <link
      tag="link"
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="/assets/logo.png"
    />

    <meta tag="meta" property="og:title" content="Parayu" />
    <meta tag="meta" property="og:site_name" content="Parayu" />
    <meta
      tag="meta"
      property="og:url"
      content="https://parayu.toolbomber.com"
    />
    <meta
      tag="meta"
      property="og:description"
      content="Simple text to speech"
    />
    <meta tag="meta" property="og:type" content="product" />
    <meta tag="meta" property="og:image" content="/assets/social_preview.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Parayu" />
    <meta name="twitter:description" content="Simple text to speech" />
    <meta name="twitter:image" content="/assets/social_preview.png" />

    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.toolbomber.com/js/WebArray.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.4/lottie.min.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
    />
    <style>
      [x-cloak] {
        display: none;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.toolbomber.com/css/tw.css" />
  </head>
  <body>
    <div
      x-data="{ isConverting: false, isPlaying: false, audioURL: 'https://bff.listnr.tech/backend/audio/get/201103a7-5870-43ef-94c5-4b27726e806d_gc.mp3', placeholder: 'Press play for instructions! ☝️' }"
      class="page bg-dark-200 c"
    >
      <audio
        id="audio-player"
        class="hidden"
        x-bind:src="audioURL"
        preload="auto"
      ></audio>
      <div
        class="w-full h-screen max-w-3xl bg-dark-200 flex flex-col justify-end px-4 py-24 gap-4"
      >
        <div class="h-full bg-gray-800 rounded-lg overflow-hidden">
          <div
            class="history-card flex-col h-full c p-4 bg-gray-100 cursor-pointer hover:bg-white t relative"
            @click="!isPlaying ? play() : stop() ; isPlaying = !isPlaying; placeholder = 'Paste text here..' ; "
          >
            <div
              id="play-pause-animation"
              class="play-button mr-4 h-48 w-48 p-1"
            ></div>
            <div
              class="meta text-xs text-black text-opacity-60 absolute bottom-4 hidden"
            >
              just now
            </div>
          </div>
        </div>
        <div class="h-1/2">
          <textarea
            id="text"
            x-bind:placeholder="placeholder"
            class="w-full p-4 h-full rounded-lg shadow-inner"
          ></textarea>
        </div>
        <div
          class="w-full bg-yellow-300 h-32 rounded-lg c cursor-pointer"
          @click="isConverting = !isConverting; if(isConverting) { audioURL = await getAudio() ; isConverting = false ; audioPlayer.play() }"
        >
          <div
            x-cloak
            x-show="!isConverting"
            class="open-sans text-3xl font-extralight uppercase tracking-wide"
          >
            Convert
          </div>
          <div x-cloak x-show="isConverting" class="w-8">
            <div id="convert-animation"></div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    window.animationInstance = bodymovin.loadAnimation({
      container: document.getElementById("convert-animation"),
      path: "/convert.json",
      renderer: "svg",
      loop: true,
      autoplay: true,
    })

    window.playPauseAnimation = bodymovin.loadAnimation({
      container: document.getElementById("play-pause-animation"),
      path: "/play-pause.json",
      renderer: "svg",
      loop: false,
      autoplay: false,
    })

    window.audioPlayer = document.querySelector("#audio-player")

    window.play = () => {
      playPauseAnimation.setDirection(1)
      playPauseAnimation.play()
      audioPlayer.play()
    }

    window.stop = () => {
      playPauseAnimation.setDirection(-1)
      playPauseAnimation.play()
      audioPlayer.pause()
    }

    window.getAudio = async () => {
      const textArea = document.querySelector("textarea")
      const text = textArea.value

      if (text.trim() === "") {
        return
      }

      const encodedText = encodeURIComponent(text)

      return await fetch(
        `https://parayu.toolbomber.com/api/tts?text=${encodedText}`
      ).then(r => r.text())
    }

    https: audioPlayer.addEventListener("ended", () => {
      stop()
    })
  </script>
</html>
